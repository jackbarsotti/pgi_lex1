<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>New_Deal</fullName>
    <availability>online</availability>
    <displayType>massActionButton</displayType>
    <linkType>javascript</linkType>
    <masterLabel>New Quote/Contract</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <requireRowSelection>false</requireRowSelection>
    <url>{!REQUIRESCRIPT(&quot;/soap/ajax/23.0/connection.js&quot;)} 
{!REQUIRESCRIPT(&quot;/soap/ajax/23.0/apex.js&quot;)} 
var cQuote = new sforce.SObject(&quot;Quote&quot;);
var QuoteRecord = sforce.connection.query(&quot;Select OpportunityId, Id From Quote where OpportunityId=&apos;{!Opportunity.Id}&apos; &quot;); 
var records = QuoteRecord.getArray(&quot;records&quot;); 
if(&apos;{!$Profile.Name}&apos; == &apos;PGi Contract Manager&apos;) {
cQuote.Name=&quot;Do Not Edit&quot;;
cQuote.File_Store_Contract_Status__c=&quot;Active&quot;;
cQuote.InterestPenaltyPercent__c=&quot;1.5&quot;;
cQuote.Government_Entity_Customer__c=&quot;N/A&quot;;
cQuote.Opportunityid=&quot;{!Opportunity.Id}&quot;;
var result=sforce.connection.create([cQuote]);
window.parent.location.href=&apos;/&apos;+result[0].id;
}
else if(&apos;{!Opportunity.Type}&apos;==&apos;Co-Terminus License - Hub Only&apos; || &apos;{!Opportunity.Type}&apos;==&apos;Existing Cust-Amendment-New Svc&apos; || &apos;{!Opportunity.Type}&apos;==&apos;Existing Cust-Amendment-Existing Svc&apos; || &apos;{!Opportunity.Type}&apos;==&apos;Renewal (No Change)&apos; || &apos;{!Opportunity.Type}&apos;==&apos;Event Services-1x Event (No Paper)&apos; || &apos;{!Opportunity.Type}&apos;==&apos;Event Services&apos;)
{
alert(&quot;A Q/C record cannot be created for this Opportunity Type.&quot;);
window.parent.location.href=window.parent.location.href;
} 
else if(records[0] != null)
{ 
alert(&apos;A Quote/Contract Entry already exists. If you need to create an additional entry you can clone this Opportunity and create one there.&apos;); 
window.parent.location.href=window.parent.location.href;
}
else
{
cQuote.Name=&quot;Do Not Edit&quot;;
cQuote.File_Store_Contract_Status__c=&quot;Active&quot;;
cQuote.InterestPenaltyPercent__c=&quot;1.5&quot;;
cQuote.Government_Entity_Customer__c=&quot;N/A&quot;;
cQuote.Opportunityid=&quot;{!Opportunity.Id}&quot;;
var result=sforce.connection.create([cQuote]);
if (result[0].getBoolean(&quot;success&quot;)) {
window.parent.location.href=&apos;/&apos;+result[0].id;
}
}</url>
</WebLink>
