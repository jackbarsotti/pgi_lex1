<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>New_Deal</fullName>
    <availability>online</availability>
    <displayType>massActionButton</displayType>
    <linkType>javascript</linkType>
    <masterLabel>New Quote/Contract</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <requireRowSelection>false</requireRowSelection>
    <url>{!REQUIRESCRIPT(&quot;/soap/ajax/23.0/connection.js&quot;)} 
{!REQUIRESCRIPT(&quot;/soap/ajax/23.0/apex.js&quot;)} 
var cQuote = new sforce.SObject(&quot;Quote&quot;);
var QuoteRecord = sforce.connection.query(&quot;Select OpportunityId, Id From Quote where OpportunityId=&#39;{!Opportunity.Id}&#39; &quot;); 
var records = QuoteRecord.getArray(&quot;records&quot;); 
if(&#39;{!$Profile.Name}&#39; == &#39;PGi Contract Manager&#39;) {
cQuote.Name=&quot;Do Not Edit&quot;;
cQuote.File_Store_Contract_Status__c=&quot;Active&quot;;
cQuote.InterestPenaltyPercent__c=&quot;1.5&quot;;
cQuote.Government_Entity_Customer__c=&quot;N/A&quot;;
cQuote.Opportunityid=&quot;{!Opportunity.Id}&quot;;
var result=sforce.connection.create([cQuote]);
window.parent.location.href=&#39;/&#39;+result[0].id;
}
else if(&#39;{!Opportunity.Type}&#39;==&#39;Co-Terminus License - Hub Only&#39; || &#39;{!Opportunity.Type}&#39;==&#39;Existing Cust-Amendment-New Svc&#39; || &#39;{!Opportunity.Type}&#39;==&#39;Existing Cust-Amendment-Existing Svc&#39; || &#39;{!Opportunity.Type}&#39;==&#39;Renewal (No Change)&#39; || &#39;{!Opportunity.Type}&#39;==&#39;Event Services-1x Event (No Paper)&#39; || &#39;{!Opportunity.Type}&#39;==&#39;Event Services&#39;)
{
alert(&quot;A Q/C record cannot be created for this Opportunity Type.&quot;);
window.parent.location.href=window.parent.location.href;
} 
else if(records[0] != null)
{ 
alert(&#39;A Quote/Contract Entry already exists. If you need to create an additional entry you can clone this Opportunity and create one there.&#39;); 
window.parent.location.href=window.parent.location.href;
}
else
{
cQuote.Name=&quot;Do Not Edit&quot;;
cQuote.File_Store_Contract_Status__c=&quot;Active&quot;;
cQuote.InterestPenaltyPercent__c=&quot;1.5&quot;;
cQuote.Government_Entity_Customer__c=&quot;N/A&quot;;
cQuote.Opportunityid=&quot;{!Opportunity.Id}&quot;;
var result=sforce.connection.create([cQuote]);
if (result[0].getBoolean(&quot;success&quot;)) {
window.parent.location.href=&#39;/&#39;+result[0].id;
}
}</url>
</WebLink>
