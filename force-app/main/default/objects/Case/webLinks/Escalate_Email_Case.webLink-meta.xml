<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>Escalate_Email_Case</fullName>
    <availability>online</availability>
    <displayType>button</displayType>
    <linkType>javascript</linkType>
    <masterLabel>Escalate Email Case</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <url>(
{!REQUIRESCRIPT(&quot;/support/console/45.0/integration.js&quot;)}
function() {

var width;
var height;
var title = &quot;Escalate Case&quot;;
var recId = &#39;{!Case.Id}&#39;;
var Escalated= &#39;{!Case.Escalated__c}&#39;;
// To Handle Dialog CSS we are using query
var query = &quot;SELECT Escalated__c FROM Case WHERE Id = &#39;&quot; + recId + &quot;&#39; LIMIT 1&quot;;
var caseRec = sforce.connection.query(query);
var stats= caseRec.getArray(&quot;records&quot;);
if(stats[0].Escalated__c == &#39;true&#39;){
width = 412;
height = 125;
} else{
width = 500;
height = 200;
}
var id=window.location.href.substring(window.location.href.lastIndexOf(&#39;/&#39;) + 1);

var box = new SimpleDialog(&quot;salesforce&quot; + Math.random(), true);
box.setTitle(title);
box.displayX = true;
box.isMovable = false;
box.createDialog();
box.setWidth(width);
// set your html content here
box.setContentInnerHTML(
&#39;&lt;iframe src=&quot;/apex/EscalateEmailCase?Id=&#39;+recId+&#39;&quot; style=&quot;border:none;&quot; width=&quot;100%&quot; height=&quot;&#39;+ (height - 10)+&#39;px&quot; /&gt;&#39;
);
//set the height of the modal
box.dialog.children[1].style.height = height + &#39;px&#39;;
box.show();

//if displayX is set to true, then override standard close event by this code
box.dialog.getElementsByClassName(&#39;dialogClose&#39;)[0].onclick = function() {
box.hide();
// you can add code to reload the page or redirect to another page
};
//optional : add this to close the modal onclick of the overlay background
box.background.addEventListener(&#39;click&#39;, function() {
box.hide();
});

// if you want to be able to close the modal from the Visualforce page
window.addEventListener(&#39;message&#39;, function(event){
var str = event.data;
var res = str.split(&quot; &quot;);
if(event.data === &#39;close&#39;){
box.hide();
}
else if(res[0] === &#39;close&#39;){
if(sforce.console.isInConsole()){
let urlrecord = window.location.origin+&#39;/&#39;+res[1]+&#39;/e?retURL=&#39;+res[1];
sforce.console.openPrimaryTab(null, urlrecord ,true);
}
else{
window.open(window.location.href =&#39;/&#39;+res[1]+&#39;/e?retURL=&#39;+res[1],&quot;_self&quot;);
}
box.hide();

}
});
})();</url>
</WebLink>
