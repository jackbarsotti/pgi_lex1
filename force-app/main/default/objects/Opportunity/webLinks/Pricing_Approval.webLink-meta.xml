<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>Pricing_Approval</fullName>
    <availability>online</availability>
    <displayType>button</displayType>
    <linkType>javascript</linkType>
    <masterLabel>Pricing Approval</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <url>{!REQUIRESCRIPT(&quot;/soap/ajax/32.0/connection.js&quot;)}
{!REQUIRESCRIPT(&quot;/soap/ajax/32.0/apex.js&quot;)}
    
    //var newRecords = [];
    //var o = new sforce.SObject(&quot;Opportunity&quot;);
    //var previousRecordType = &quot;{!Opportunity.RecordTypeId}&quot;

    //var recType = sforce.connection.query(&quot;SELECT name, Id from RecordType where developername = &#39;Pricing_Approval&#39;&quot;);
    //var records = recType.getArray(&quot;records&quot;);
     
    if (&#39;{!Opportunity.Count_of_Products__c}&#39; == 0) {
        alert(&quot;Add products before submitting for Pricing Approval.&quot;);
    }
    else {

      var flowURI = encodeURI(&#39;/flow/PricingApproval?oppyId={!Opportunity.Id}&amp;retURL=/{!Opportunity.Id}&#39;);
      window.open(flowURI);
    /*o.id =&quot;{!Opportunity.Id}&quot;; 
    o.RecordTypeId = records[0].Id;
    o.Previous_Record_Type__c = previousRecordType;
    newRecords.push(o); 
    result = sforce.connection.update(newRecords); 
    window.location.reload();*/
}</url>
</WebLink>
