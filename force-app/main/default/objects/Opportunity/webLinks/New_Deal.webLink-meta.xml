<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>New_Deal</fullName>
    <availability>online</availability>
    <displayType>button</displayType>
    <linkType>javascript</linkType>
    <masterLabel>New Quote/Contract</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <url>{!REQUIRESCRIPT(&quot;/soap/ajax/23.0/connection.js&quot;)} 
{!REQUIRESCRIPT(&quot;/soap/ajax/23.0/apex.js&quot;)} 

var OppRecords = sforce.connection.query(&quot;Select StageName From Opportunity where Id=&apos;{!Opportunity.Id}&apos;&quot;);
var oppRecord= QuoteRecord.getArray(&quot;records&quot;);
alert(oppRecord[0].stageName);Â 

if(oppRecord[0].stageName == &apos;Evaluate Options&apos;){ 
	var QuoteRecord = sforce.connection.query(&quot;Select OpportunityId, Id, From Quote where OpportunityId=&apos;{!Opportunity.Id}&apos; &quot;); 
	var records = QuoteRecord.getArray(&quot;records&quot;); 
	if(records[0] != null){ 
		alert(&apos;Deal record already exists&apos;); 
	}else{ 
		window.location.href =&apos;/apex/newQuote?oppid={!Opportunity.Id}&apos;; 
	}
else{
	alert(&apos;Deal will be created only the Stage is Evaluate Options&apos;); 
}</url>
</WebLink>
