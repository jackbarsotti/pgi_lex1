<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>New_Deal</fullName>
    <availability>online</availability>
    <displayType>button</displayType>
    <linkType>javascript</linkType>
    <masterLabel>New Quote/Contract</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <url>{!REQUIRESCRIPT(&quot;/soap/ajax/23.0/connection.js&quot;)} 
{!REQUIRESCRIPT(&quot;/soap/ajax/23.0/apex.js&quot;)} 

var OppRecords = sforce.connection.query(&quot;Select StageName From Opportunity where Id=&#39;{!Opportunity.Id}&#39;&quot;);
var oppRecord= QuoteRecord.getArray(&quot;records&quot;);
alert(oppRecord[0].stageName);Â 

if(oppRecord[0].stageName == &#39;Evaluate Options&#39;){ 
	var QuoteRecord = sforce.connection.query(&quot;Select OpportunityId, Id, From Quote where OpportunityId=&#39;{!Opportunity.Id}&#39; &quot;); 
	var records = QuoteRecord.getArray(&quot;records&quot;); 
	if(records[0] != null){ 
		alert(&#39;Deal record already exists&#39;); 
	}else{ 
		window.location.href =&#39;/apex/newQuote?oppid={!Opportunity.Id}&#39;; 
	}
else{
	alert(&#39;Deal will be created only the Stage is Evaluate Options&#39;); 
}</url>
</WebLink>
