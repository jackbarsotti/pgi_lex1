<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>Generate_CIF_NA_Only</fullName>
    <availability>online</availability>
    <displayType>button</displayType>
    <linkType>javascript</linkType>
    <masterLabel>Generate NCS</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <url>{!REQUIRESCRIPT(&quot;/soap/ajax/29.0/connection.js&quot;)}
{!REQUIRESCRIPT(&quot;/soap/ajax/29.0/apex.js&quot;)}
var isWon = &quot;{!Opportunity.IsWon}&quot;;

// we&#39;re getting profile as merge field instead of with SOQL below b/c most users don&#39;t have permissions to see ProfileId field
var userProfile = &quot;{!$Profile.Id}&quot;;

// can&#39;t use merge fields to get picklist values that aren&#39;t in the DOM, so using SOQL to get user region
var query = &quot;SELECT User_Region__c from User WHERE Id = &#39;{!$User.Id}&#39;&quot;;
var result = sforce.connection.query(query);
var records = result.getArray(&quot;records&quot;);
var userRegion = records[0].User_Region__c;

function checkRegionAndProfile() {
        // System Administrator
    if (userProfile === &quot;00e30000001kms9&quot;
        // NA region
        || userRegion === &quot;NA&quot;
        // EMEA region &amp; PGi Implementation Services profile
        || (userRegion === &quot;EMEA&quot; &amp;&amp; userProfile === &quot;00ea0000001sYR8&quot;)
    ) {
        checkIsWonAndProceed();
    } else {
        alert(&quot;This is for NA Sales &amp; IST Users and EMEA IST Users Only.&quot;);
    }
}

function checkIsWonAndProceed() {
    if (isWon != 1) {
        alert(&quot;You cannot create a NCS Form until you have closed the opportunity.&quot;);
    } else {
        window.parent.location.href = &quot;/apex/ist_ncs_form?opp={!Opportunity.Id}&quot;;
    }
}

checkRegionAndProfile();</url>
</WebLink>
