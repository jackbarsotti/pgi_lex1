<?xml version="1.0" encoding="UTF-8"?>
<ValidationRule xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>PGi_Cant_Close_Opp_with_Open_eSignature</fullName>
    <active>true</active>
    <description>Cannot close an opportunity with an open eSignature.</description>
    <errorConditionFormula>AND(
CONTAINS(RecordType.Name, &quot;PGi&quot;),
$User.ProfileId &lt;&gt; &quot;00e30000001kms9&quot;, 
CONTAINS($User.Profile_Name_Text__c , &quot;Sales User&quot;) || 
CONTAINS($User.Profile_Name_Text__c , &quot;Sales Mgr&quot;), 
$User.Override_Validation_Rules__c = False,
ISPICKVAL( StageName , &quot;Closed Won&quot;) ||
ISPICKVAL( StageName , &quot;Closed Pending Approval&quot;) ||
ISPICKVAL( StageName , &quot;Closed Lost&quot;),
NOT(ISBLANK( Agreement_Status__c )),
Agreement_Status__c &lt;&gt; &quot;Draft&quot;,
Agreement_Status__c &lt;&gt; &quot;Cancelled&quot;,
Agreement_Status__c &lt;&gt; &quot;Approved&quot;,
Agreement_Status__c &lt;&gt; &quot;Signed&quot;,
Agreement_Status__c &lt;&gt; &quot;Cancelled / Declined&quot;,
NOT(ISCHANGED( NCS_Generated_Date__c ))
)</errorConditionFormula>
    <errorMessage>You cannot close the Opportunity as Closed Won or Closed Lost if the eSignature Agreement is still open. Please close all eSignature Agreements first, then close the Opportunity.</errorMessage>
</ValidationRule>
